define("system-core:pluginHub/Broker/deps/processor.js",function(require,exports,module){function handleMeta(metaValue,fileMetaList){var isEqual=!0;/^!/.test(metaValue)&&(metaValue=metaValue.slice(1),isEqual=!1),/^\$/.test(metaValue)&&(metaValue=eval(metaValue.replace(/^\$/,"window.")));var canUse=!0;return $.each(fileMetaList,function(e,r){return"*"===metaValue&&void 0!==r?!0:isEqual&&metaValue!==r||!isEqual&&metaValue===r?canUse=!1:void 0}),canUse}function condCheck(e,r){var t=!1;return $.each(e,function(a){var n=conditionTypes[a];return n&&(t=n(e,r)),t?!1:void 0}),t}var $=require("base:widget/libs/jquerypacket.js"),_=require("base:widget/libs/underscore.js"),router=require("base:widget/router/Router.js").app,tools=require("base:widget/tools/tools.js"),conditionTypes={filesType:function(e,r){var t=r.length;if(!t)return!0;for(var a=e.filesType,n=a.split(","),i=!!e.filesTypeStrongMatch,u="",o=0,s=t;s>o;o++){var l=r[o];if(u=tools.getFileCategory(l.server_filename||l.file_name),!u||1===+l.isdir)return!0;if(i){if(!~n.indexOf(u,n))return!0}else if(!~a.indexOf(u))return!0}return!1},pageModule:function(e){var r=e.pageModule,t=router.currentRouteName;return r&&"*"!==r&&-1===r.indexOf(t)},meta:function(e,r){if(!r.length)return!0;var t=e.meta;_.isArray(t)||(t=[t]);var a=!0;return $.each(t,function(e,t){var n=!0;return $.each(t,function(e,t){return handleMeta(t,_.pluck(r,e))?void 0:n=!1}),n?a=!1:void 0}),a},filesLimit:function(e,r){var t=e.filesLimit,a=r.length,n="===",i=+t;if(_.isString(t)&&/^[<>]=?/.test(t)){n=t.charAt(0);var u="="===t.charAt(1);u&&(n+="=");var o=1+Number(u);i=parseInt(t.substring(o),10)}var s=!0;return"==="===n&&(s=a===t),"<"===n&&(s=i>a),"<="===n&&(s=i>=a),">"===n&&(s=a>i),">="===n&&(s=a>=i),!s},excludeDirType:function(e,r){var t=e.excludeDirType,a=r.length;if(t&&a)for(var n=new RegExp("^"+t.replace(/,/g,"|")+"$"),i=0,u="",o=a;o>i;i++)if(u=r[i].path,u&&n.test(u.substring(u.lastIndexOf("/")+1)))return!0;return!1},path:function(e){var r=(location.hash.match(/path=([^?&=\/]+)/)||[,""])[1];r=decodeURIComponent(r);var t=e.path,a="equal",n=t;return t.indexOf("!")>-1&&(a="noEqual",n=t.slice(1)),"equal"===a?n!==r:n===r}};module.exports=function(e,r){r||(r=[]),_.isArray(e)||(e=[e]);var t=!1;return $.each(e,function(e,a){return t=condCheck(a,r),t?void 0:!1}),t}});
;define("system-core:pluginHub/Broker/deps/XButtonBox.js",function(require,exports,module){function getBoxContext(t,n){return'<div class="'+t+'" style="position:absolute;top:0;line-height:normal;padding-top:'+n+';"></div>'}function XButtonBox(t,n){return this instanceof XButtonBox?(this.config=t=_.extend({name:"",className:"x-button-box",limit:10,buttons:null,container:null,containerWidth:0,alwaysShow:!1,autoWidth:!1,paddingLeft:!1,resize:!1,autoHide:!1,hideWhenAllButtonDisable:!1,cachePaddingLeft:!0},t),this.events=n||{},this.name=t.name,this.buttonsData=t.buttons||getButtons(this.name)||[],this.buttons=[],this.buttonsInMore=[],this.moreButton=null,this.$container=$(t.container).css({"white-space":"nowrap",position:"relative"}),this.$positionMark=$(MARK),this.$separateMask=$(separateMask),this.$box=$(getBoxContext(t.className,this.$container.css("padding-top"))),this.$container.append(this.$positionMark),this.$container.append(this.$box),this.$box.prepend(this.$separateMask),this.containerOffsetLeft=-1,this._initData(),XButtonBox.instances.push(this),this.config.autoHide&&this.hide(),void this._emitEvent("ready")):new XButtonBox(t,n)}function showRedLightIcon(t,n){return t?(_.isArray(t)||(t=[t]),_.some(t,function(t){for(var o in t)if(t.hasOwnProperty(o)){var i=t[o],e=n[o];if("*"===i&&(i=e),i!==e||void 0===e)return!1}return!0})):!1}var $=require("base:widget/libs/jquerypacket.js"),_=require("base:widget/libs/underscore.js"),processor=require("system-core:pluginHub/Broker/deps/processor.js"),context=require("system-core:context/SystemContext.js").instanceForSystem,Message=context.message,getButtons=context.pluginControl.BrokerData.getButton,MARK='<div class="button-box-mark" style="display:inline-block;*display:inline;*zoom:1;width:1px;height:1px;line-height:0;"></div>',separateMask='<div style="display:none;width:100%;height:100%;z-index:30;position:absolute;top:0;left:0;"></div>',GRAY_SHOW="GRAY_SHOW",COOL_SHOW="COOL_SHOW",SAD_HIDE="SAD_HIDE";XButtonBox.instances=[],XButtonBox.filesSelect=function(t){for(var n=0,o=XButtonBox.instances.length;o>n;n++)XButtonBox.instances[n].filesSelect(t)},XButtonBox.prototype.on=function(t,n){if(t&&_.isFunction(n)){var o=this.events[t];o?_.isArray(o)?this.events[t].push(n):this.events[t]=[o,n]:this.events[t]=[n]}},XButtonBox.prototype.emit=XButtonBox.prototype._emitEvent=function(t){if(t){var n=this.events[t];if(n){var o=this,i=[].slice.call(arguments,1);_.isArray(n)?_.each(n,function(t){t.apply(o,i)}):n.apply(o,i)}}},XButtonBox.prototype._initData=function(){var that=this;this.buttonsData=_.chain(this.buttonsData).sortBy("index").filter(function(button){return button.yunData?_.isString(button.yunData)?eval(button.yunData):_.isObject(button.yunData)?_.isMatch(yunData,button.yunData):!0:!0}).each(function(t,n){that._bindButtonEvents(t),that._makeButtonInstance(t,n)}).value(),this.buttonsRender(),this._initMoreButton(),this.config.resize&&$(window).bind("resize",_.throttle(function(){that.$container.width()&&that.$box.width()&&that._buttonsArrangement()},300))},XButtonBox.prototype._bindButtonEvents=function(t){var n=null;if(t.click||t.link||"dropdown"===t.type?_.isString(t.click)&&(n={run:t.click,config:t}):n={run:t.action,config:t},n&&(t.click=function(o){o="object"==typeof o?$.extend({},n,o):n,Message.trigger("plugin:"+t.pluginId,o),_.isString(t.log)&&context.log.send({type:t.log})}),_.each(["mouseEnter","mouseLeave","beforeOpen","beforeClose"],function(n){var o=t[n];_.isString(o)&&(t[n]=function(n){n="object"==typeof n?$.extend({},{run:o},n):{run:o},Message.trigger("plugin:"+t.pluginId,n)})}),_.isString(t.menu)){var o=t.menu;t.menu=function(n,i){Message.trigger("plugin:"+t.pluginId,{run:o,dom:n,format:i})}}return"dropdown"===t.type&&"object"==typeof t.menu&&t.menu.length&&_.each(t.menu,function(n){if(_.isString(n.click)){var o=n.click;n.click=function(n){n="object"==typeof n?$.extend({},{run:o},n):{run:o},Message.trigger("plugin:"+t.pluginId,n)}}}),t},XButtonBox.prototype._makeButtonInstance=function(t,n){var o=t.conditions||{};/<%.+%>/.test(t.title)&&(t.title=_.template(t.title)());var i=o.filesType,e=i&&i.length<2;e&&(t.conditions=_.omit(o,"filesType"));var s=context.ui.button(t);s.index=n,s.inMore=!1,this.buttons.push(s),s.appendTo(this.$box),this.buttonsInMore.push({title:t.title,symLink:s,click:t.click,icon:t.icon,display:"none",isShow:!1})},XButtonBox.prototype._initMoreButton=function(){this.moreButton=context.ui.button({type:"dropdown",title:"更多",resize:!0,display:"none",menu:this.buttonsInMore,icon:"icon-more"}).appendTo(this.$box),this.moreButton.dom.addClass("tools-more")},XButtonBox.prototype._getContainerPadding=function(){var t=parseInt(this.$container.css("padding-right"),10);return isNaN(t)?0:t},XButtonBox.prototype._getContainerWidth=function(){this.config.cachePaddingLeft===!1?this.containerOffsetLeft=this.$positionMark.position().left:-1===this.containerOffsetLeft&&(this.containerOffsetLeft=this.$positionMark.position().left);var t=this.containerOffsetLeft,n=this.config.paddingLeft;n=n===!1?t:n;var o=0;o=this.$container.is(":hidden")?$(".list-header-operate").innerWidth():this.$container.innerWidth();var i=o-this._getContainerPadding()-(n||t);this.$box.css("padding-left",n),this.$box.width(this.config.autoWidth?"auto":i);var e=this.config.containerWidth;return e=_.isFunction(e)?e():e,0>=i&&e?e:i},XButtonBox.prototype._getMoreBtnIndex=function(){function t(n){var s=o.buttons[n];if(!s)return-1;s.status!==SAD_HIDE&&(r-=s.width);var a=i-r;return a>=e?n:t(n-1)}for(var n,o=this,i=this._getContainerWidth(),e=this.moreButton.width,s=this.buttons.length,r=0,a=0,u=0;s>u&&(n=this.buttons[u],n.status!==SAD_HIDE&&(r+=n.width,a++),!(a>this.config.limit))&&!(r>i);u++);return s>u?t(u):1/0},XButtonBox.prototype._buttonsArrangement=function(){for(var t,n=this.buttons.length,o=this._getMoreBtnIndex(),i=0,e=!1;n>i;i++)t=this.buttons[i],e||(e=i>=o),e&&t.hide(),t.inMore=e,this.moreButton.menuShow(i,e&&t.status!==SAD_HIDE),this.moreButton.menuDisable(i,t.status!==COOL_SHOW);var s=1/0!==o;s?(this.moreButton.dom.prev().removeClass("last-button"),this.moreButton.show()):(this.moreButton.dom.prev().addClass("last-button"),this.moreButton.hide())},XButtonBox.prototype._disableButton=function(t,n){var o="";n===!1?(t.disable(!1).show(),o=COOL_SHOW):"disable"===t.config.disabled?(t.disable().show(),o=GRAY_SHOW):(t.hide(),o=SAD_HIDE),t.status=o},XButtonBox.prototype.getContent=function(){return this.$container.html()},XButtonBox.prototype.triggerClick=function(t,n){t=parseInt(t,10);var o=this.buttons[t];o&&o.triggerClick(n),this._emitEvent("buttonClick");var i=n&&n.position&&n.position[0];if(o.hasRedLightIconHtml&&void 0!==i){var e=context.getList().getListItemDomByPostion(i),s=$(e).find(".operate"),r=s.find(".show-icon");r.length&&r.removeClass("show-icon")}},XButtonBox.prototype.filesSelect=function(t,n){n&&n.paddingLeft&&(this.config.paddingLeft=n.paddingLeft),this.resizeButtons(t),this._emitEvent("filesSelect",t)},XButtonBox.prototype.hide=function(){this.$box.hide()},XButtonBox.prototype.show=function(){this.$box.show()},XButtonBox.prototype.buttonsRender=function(){_.each(this.buttons,function(t){if(t.dom.length){var n=this.buttonsData[t.index];_.isFunction(n.render)?n.render({$dom:t.dom,button:t}):_.isString(n.render)&&Message.trigger("plugin:"+n.pluginId,{run:n.render,$dom:t.dom,button:t})}},this)},XButtonBox.prototype.lock=function(t){t?this.$separateMask.show():this.$separateMask.hide()},XButtonBox.prototype.resizeButtons=function(t){var n=this.config.alwaysShow;n||(this.$box.addClass("opacity-button-box"),this.$box.css({visibility:"hidden",width:0}));var o=!1,i=!0;_.each(this.buttons,function(n){var e=n.config.conditions||{};if(e.change){var s=n.index,r=t.length-e.change.filesCount,a=e.change.changeInfo,u="eq";r>0?u="gt":0>r&&(u="lt");var h=a[u];if(h){var c=this.buttonsInMore[s];c.icon=h.icon,c.title=h.title;var d=this.moreButton._renderMenuOne(c);this.moreButton.dom.find("a.g-button-menu").eq(s).replaceWith(d),n.change(h)}}var l=processor(e,t);i=i&&l,this._disableButton(n,l),!l&&n.hasRedLightIconHtml&&(o=this.checkItemRedLightIconShow(n,t))},this),this.showRedPotAtMore(o),this._buttonsArrangement(),this.$box.removeClass("opacity-button-box"),t&&t.length&&this.$box.css("visibility","visible"),this.config.hideWhenAllButtonDisable&&i?this.hide():this.show(),this._emitEvent("resizeButtons")},XButtonBox.prototype.checkItemRedLightIconShow=function(t,n){if(1===n.length){var o=showRedLightIcon(t.config.redLightIcon,n[0]),i=t.inMore&&t.status===COOL_SHOW,e=t.index,s="b-menu"+e;this.buttonsInMore[e].showRedLightIcon=t.showRedLightIcon=o;var r=o?"addClass":"removeClass";return i?this.moreButton.dom.find('[data-menu-id="'+s+'"] .button-red-light-icon')[r]("show-icon"):t.dom.find(".button-red-light-icon")[r]("show-icon"),i&&o}},XButtonBox.prototype.showRedPotAtMore=function(t){this.moreButton.dom.find(".tools-more-red-light-icon")[t?"addClass":"removeClass"]("show-icon")},module.exports=XButtonBox});
;define("system-core:pluginHub/Broker/deps/XMenu.js",function(e,n,t){function o(e,n){var t=null;e.nextMenu||e.variableMenu||e.length?"string"==typeof e.variableMenu&&(t=e.variableMenu,e.variableMenu=function(e,o){a.trigger("plugin:"+n,{dom:e,format:o,run:t})}):e.action?"string"==typeof e.action&&(t=e.action,e.action=function(o){a.trigger("plugin:"+n,{run:t,dom:o}),"string"==typeof e.log&&u.log.send({type:e.log})}):e.action=function(){a.trigger("plugin:"+n),"string"==typeof e.log&&u.log.send({type:e.log})},e.conditions&&(e.display=function(){var n=u.getList().getCheckedItems(),t=e.conditions,o=s(t,n);return o===!0?"disable"===e.disabled?"disable":!1:!0})}function i(e,n){var t=n.middle?n.middle.slice(0):[],i=n.bottom?n.bottom.slice(0):[],s=n.top?n.top.slice(0):[];return r.chain(e).sortBy("index").filter(function(e){var n=e.conditions;return n&&n.templateVar?r.isMatch(d,n.templateVar):!0}).each(function(e){"middle"===e.position?t.push(e):"bottom"===e.position?i.push(e):s.push(e),e.length?r.each(e,function(n){o(n,e.pluginId)}):o(e,e.pluginId)}),s.push(t,i),s}var r=e("base:widget/libs/underscore.js"),s=e("system-core:pluginHub/Broker/deps/processor.js"),u=e("system-core:context/SystemContext.js").instanceForSystem,a=u.message,l=u.ui.contextMenu,c=u.pluginControl.BrokerData.getMenu,d=window.yunData;t.exports.bindContextMenu=function(e){var n=e.target,t=e.config,o=e.type,r=e.events,s=o?c(o):[];t||(t={middle:[],bottom:[],top:[]});var u=i(s,t);n&&u&&r&&l(n,u,{beforeMenu:r.beforeMenu,afterMenu:r.afterMenu,menuHide:r.menuHide})}});
;define("system-core:pluginHub/Broker/Broker.js",function(e,n,r){var t=e("base:widget/libs/underscore.js"),o=e("system-core:pluginHub/Broker/deps/XMenu.js"),u=e("system-core:pluginHub/Broker/deps/XButtonBox.js"),s=Object.create?Object.create(null):{};r.exports.initMenuBroker=function(e){o.bindContextMenu(e)},r.exports.initButtonBroker=function(e){return t.isArray(e)||(e=[e]),t.each(e,function(e){var n=e.config;n.name=e.name,s[e.name]=u(n,e.events)}),1===e.length?s[e[0].name]:void 0},r.exports.getButtonBroker=function(e){return s[e]}});